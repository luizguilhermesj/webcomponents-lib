---
title: Sass unit tests
template: doc.pug
---

## Sass unit tests?

The Design system supports [Sass True](https://github.com/oddbird/true), a unit-testing tool for Sass code that runs in any Sass compiler and provides integration with JavaScript test runners such as [Jest](https://jestjs.io/).

Please get familiar with both libraries, before you continue reading.

## Is this compulsory?
Yes, it is. in order to preserve all design system consumers stable, we required you to write tests for all major implementations.

Initially `src/settings` and `src/tools` are covered. And `src/elements` & `src/components` are coming next.

## Run sass tests
Simply run `npm test`

```bash
 PASS  src/__tests__/scss.spec.js
  Sass
    from breakpoint @mixin
      ✓ Breakpoint sizes are setup correctly matching design specs (1ms)
      ✓ Outputs breakpoint media query when nesting inside class
      ✓ Outputs breakpoint media query with class nested inside
      ✓ Outputs breakpoint media query with orientation mode
      ✓ Outputs breakpoint media query skipping invalid orientation mode
      ✓ Outputs error for non-existing/valid breakpoint value (1ms)
      ✓ Outputs breakpoint media queries with the passed prefix class selector
      ✓ Outputs error for non-existing/valid prefix value
    spacing() function
      ✓ $pixel-grid-base is setup correctly matching design specs
      ✓ returns the correct value when a string key passed
      ✓ returns the correct value when integer key passed
    ...
```

## How does the setup looks like?
### File organization
* Tests files are located under `__tests__` directory.
* File names follow the format: `{molecule}.spec.scss`.

### Tests runner
* Tests are run via `jest`. then
* a JS script `src/__tests__/scss.spec.js` will resolve all files under `'src/**/*.spec.scss'`, and
* finally, it will use `sass-true` lib to run `True` on every file found with the `describe` and `it` methods provided.

## How to write a test file?

1. Please get familiar with (Sass True)[https://www.oddbird.net/true/] fundamentals.

2. Notice that testing `@funtions`  is essentially the same as normal unit tests

    ```scss
    // testing a @function
    @include assert-equal(multiply(12, 2), 24);
    ```
    `src/__tests__/type-checking.spec.scss` makes a good example.

3. Pay special attention to how to write tests for `@mixins`. Basically, they are tests by the exact assertion of its CSS output.

    ```scss
    // testing a @mixin
    @include assert {
        @include output {
            @include typography-level(3);
        }

        @include expect {
            font-size: 24px;
            line-height: 1.5;
        }
    }
    ```
    `src/__tests__/breakpoints.spec.scss` makes a good example.

### Spec file template
Always follow following template when writing a new spec file. Adding variable `$_is-test: true` before any describe is mandatory is most cases, *check caveats section below to find out why!*.

```scss
// molecule.spec.scss 

@import "true";
@import "../path/to/molecule.scss";

$_is-test: true; // check caveats section below to find out why!

@include describe("(function | mixin) name") {
    @include it("should return *** given ***") {
        /* assertion goes here */
    }
}

```

## Caveats on writing a test file

### Testing for @funtion/@mixin erros is not supported out of the box

Consider the following example:

```scss

// type-checking.scss
@function is-number($value) {
    @if $value {
        @return type-of($value) == "number";
  } @else {
      @error "Sorry, but `#{$value}` is not a valid value for $value.";
  }
}
```

Notice two main things here:
* `$value` parameter is mandatory, and
* without a `$value`, it will fail by throwing an `@error`.

```scss
// type-checking.spec.scss
@include it("returns true for an integer") {
    @include assert-true(is-number(1));
}
```

Everything looks normal, and the true assertion for `is-number(1)` is expected to fail with `false`, and then *continue running all other `it` checks*.

**BUT** since `Sass @error calls stop the compiler` (kills it) there is no way to capture the error and continue parsing the tests, meaning the whole sass suite will fail.

To workaround this issue the `@error` statement is proxy and replaced, so it can be controlled when running the tests. See `src/tools/_error.scss`.

So instead `@error` directive:
* In @function use `@return error("msg")`.
* In @mixin use `@include error("msg")`.
* And, don't forget to define `$_is-test: true;` in each spec file.

```scss
// type-checking.spec.scss
$_is-test: true; // enable errors proxy

// type-checking.scss
@import "path/to/_error"; // import errors proxy
@function is-number($value) {
    /* ... */
    @return error("Sorry, but `#{$value}` is not a valid value for $value.");
    /* ... */
}
```

For extra context and reference, please check:
* [oddbird/true#118](https://github.com/oddbird/true/issues/118)
* [oddbird/true#92](https://github.com/oddbird/true/issues/92)
